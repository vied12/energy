"use strict";function SplashscreenDirective(){function e(){function e(){n.isClose=!0}var n=this;angular.extend(n,{isClose:!1,close:_.debounce(e)})}return{restrict:"E",templateUrl:"components/splashscreen/view.html",scope:!0,controller:e,controllerAs:"splash"}}function energyNavigation(e,n){function t(){var e=this;e.previous=n.previous,e.next=n.next,e.info=n.info,e.goTo=n.goTo,e.openImprint=n.toggleImprint.bind(null,!0),n.steps.then(function(n){e.steps=n}),e.setMarkerStyle=function(n){var t=n/(e.steps.length-1)*100;return{left:t+"%"}}}return{restrict:"E",templateUrl:"components/navigation/view.html",replace:!0,scope:!0,controller:t,controllerAs:"nav"}}function navService(e,n,t,i){function a(e){return i.go(".",{step:e},{notify:!1}),m.then(function(t){p.stepIndex=e,d=t[e].bounds,n.$broadcast("boundsSelected",d)})}function r(){return m.then(function(e){var n=p.stepIndex<e.length-1?p.stepIndex+1:0;a(n)})}function s(){return m.then(function(e){var n=p.stepIndex>0?p.stepIndex-1:e.length-1;a(n)})}function o(){return m.then(function(e){return e[p.stepIndex].bounds})}function l(e){var n;return m.then(function(t){_.forEach(t,function(t,i){return"Overview"!==t.shortName&&(n=L.latLngBounds(t.bounds.southWest,t.bounds.northEast),n.contains(L.latLng(e.lat,e.lng)))?(p.stepIndex=i,!1):void 0})})}function c(e){p.imprint=angular.isDefined(e)?e:!p.imprint}var d,p={stepIndex:parseInt(t.step||1),imprint:!1},m=e.get("assets/data/steps.json").then(function(e){return e.data.steps});return a(p.stepIndex),{next:r,previous:s,getCurrentBounds:o,goTo:a,info:p,toggleImprint:c,steps:m,updateNavigationFromCoord:_.debounce(l,500)}}function energyMap(e,n,t,i,a,r,s){function o(o){function l(){t.getMap().then(function(n){e.markers.then(function(e){var t=[];e.filter(function(e){var t=_.map(e.limited_to_zoom,function(e){return parseInt(e)});return t.indexOf(n.getZoom())>-1}).forEach(function(e){("link"===e.type||"download"===e.type)&&(angular.extend(e,{draggable:s.is("editor"),icon:{limited_to_zoom:e.limited_to_zoom,type:"div",html:s.is("editor")?'<div class="'+e.type+'"></div>':'<a href="'+e.href+'" target="_blank"><div class="'+e.type+'"></div></a>'}}),t.push(e))}),o.map.markers=t})})}function c(){t.getMap().then(function(e){_.values(e._layers).forEach(function(n){if(_.has(n,"_image")){var t=n.limited_to_zoom||n.options.icon.options.limited_to_zoom;if(t.length>0){var i=_.map(t,function(e){return parseInt(e)});n.setOpacity(i.indexOf(e.getZoom())>-1?1:0)}else n.setOpacity(1)}_.has(n.options,"icon")&&(n.setOpacity(1),_.has(n.options,"size")?angular.element(n._icon).find("div").css({width:n.options.size[e.getZoom()],height:n.options.size[e.getZoom()]}):angular.element(n._icon).find(".link").css({width:m[e.getZoom()],height:m[e.getZoom()]}))})})}function d(){t.getMap().then(function(e){_.values(e._layers).forEach(function(e){_.has(e.options,"icon")&&e.setOpacity(0)})})}o.map={};var p=r.TILES_URL;angular.extend(o.map,{center:{lat:0,lng:0,zoom:2},defaults:{tileLayer:p,zoomControlPosition:"topright",attributionControl:!1,tileLayerOptions:{minZoom:0,maxZoom:6,attribution:"ESO/INAF-VST/OmegaCAM",continuousWorld:!1,noWrap:!0,tms:!0,crs:L.CRS.Simple,detectRetina:!1,reuseTiles:!0},scrollWheelZoom:!0}}),l(),o.$on("markersUpdated",l),o.$watch("map.markers",l,!0),o.$on("resize",function(){return t.getMap().then(function(e){e._onResize(),i.getCurrentBounds().then(function(e){a(function(){o.map.goTo(e)},500)})})});var m={4:41/3,5:20.5,6:41};o.$on("leafletDirectiveMap.zoomend",l),o.$on("leafletDirectiveMap.zoomend",c),o.$on("leafletDirectiveMap.zoomstart",d),o.$watch("map.markers",c,!0);var u=[];o.map.goTo=function(e){t.getMap().then(function(n){if(s.is("editor")){u.forEach(function(e){n.removeLayer(e)});var t=L.rectangle([e.southWest,e.northEast],{color:"#ff7800",weight:3,fill:!1});t.addTo(n),u.push(t)}n.fitBounds(L.latLngBounds(e.southWest,e.northEast),{paddingBottomRight:[0,40]})})},o.$on("boundsSelected",function(e,n){return o.map.goTo(n)}),n.imageOverlays.then(function(e){t.getMap().then(function(n){e.forEach(function(e){var t=[e.bounds.southWest,e.bounds.northEast],i=L.imageOverlay(e.href,t);i.limited_to_zoom=e.limited_to_zoom,i.addTo(n)})})}),s.is("editor")&&(o.map._selectedZone=[],o.$on("leafletDirectiveMap.click",function(e,n){var i=n.leafletEvent.latlng;if(o.map._selectedZone.length<2){o.map._selectedZone.push(i);var a=o.map._selectedZone[0],r=o.map._selectedZone[1],s=L.rectangle([a,r],{color:"#ff7800",weight:3,fill:!1});t.getMap().then(function(e){s.addTo(e)}),u.push(s)}else o.map._selectedZone=[]}),o.$on("leafletDirectiveMarker.click",function(e,n){o.map.markerIndexSelected=n.markerName}),document.onkeydown=function(n){n=n||window.event,angular.isDefined(o.map.markerIndexSelected)&&("38"==n.keyCode?e.markers.then(function(e){e[o.map.markerIndexSelected].lat+=.1}):"40"==n.keyCode?e.markers.then(function(e){e[o.map.markerIndexSelected].lat-=.1}):"37"==n.keyCode?e.markers.then(function(e){e[o.map.markerIndexSelected].lng-=.1}):"39"==n.keyCode&&e.markers.then(function(e){e[o.map.markerIndexSelected].lng+=.1}))})}return o.$inject=["$scope"],{restrict:"E",controller:o,replace:!0,scope:{map:"="},templateUrl:"components/map/map.html"}}function ImprintDirective(e,n){function t(){var e=this;e.navInfo=n.info,e.closeImprint=n.toggleImprint.bind(null,!1)}return{restrict:"E",templateUrl:"components/imprint/view.html",scope:!0,controller:t,controllerAs:"imprint"}}function EditorCtrl(e,n){var t=this;n.markers.then(function(e){t.markers=e}),t.addNewLink=n.add.bind(null,"link"),t.removeLink=n.remove}function markerService(e,n,t){var i=e.get("assets/data/markers.json").then(function(e){return e.data.markers});return{markers:i,add:function(e){"link"===e&&i.then(function(e){e.push({type:"link",lat:e[e.length-1].lat,lng:e[e.length-1].lng,limited_to_zoom:["4","5","6"]}),t.$broadcast("markersUpdated")})},remove:function(e){i.then(function(n){var i=n.indexOf(e);i>-1&&(n.splice(i,1),t.$broadcast("markersUpdated"))})}}}function imageOverlayService(e){var n=e.get("assets/data/imageOverlays.json").then(function(e){return e.data.imageOverlays});return{imageOverlays:n}}angular.module("energy",["ngCookies","ngTouch","ui.router","ui.bootstrap","leaflet-directive","ngAnimate","monospaced.mousewheel"]).config(["$stateProvider","$urlRouterProvider",function(e,n){e.state("home",{url:"/?step",templateUrl:"app/main/main.html",controller:"MainCtrl"}).state("editor",{controller:["$scope","navService","markerService",function(e,n,t){n.steps.then(function(n){e.steps=n}),t.markers.then(function(n){e.markers=n}),e.getMarker=function(){var n=angular.copy(e.markers);return{markers:_.map(n,function(e){return delete e.icon,delete e.draggable,e})}}}],url:"/editor?step",templateUrl:"app/editor/editor.html"}),n.otherwise("/")}]).filter("btoa",function(){return function(e){return btoa(e)}}).filter("digit",function(){return function(e){if(null!==e&&void 0!==e){for(var n=""+e;n.length<2;)n="0"+n;return n}}}).config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|data:application)/)}]),angular.module("energy").directive("energySplash",["$window",SplashscreenDirective]),navService.$inject=["$http","$rootScope","$stateParams","$state"],angular.module("energy").directive("energyNavigation",["$http","navService",energyNavigation]).service("navService",navService),energyMap.$inject=["markerService","imageOverlayService","leafletData","navService","$timeout","$window","$state"],angular.module("energy").directive("energyMap",energyMap),angular.module("energy").directive("energyImprint",["$http","navService",ImprintDirective]),angular.module("energy").controller("EditorCtrl",["$scope","markerService","$window",EditorCtrl]),markerService.$inject=["$http","$q","$rootScope"],imageOverlayService.$inject=["$http"],angular.module("energy").service("markerService",markerService).service("imageOverlayService",imageOverlayService),angular.module("energy").directive("heightLikeWindow",["$timeout","$window","$rootScope","$state",function(e,n,t,i){var a=function(e,a){function r(){a.css("height",n.innerHeight-s+"px"),t.$broadcast("resize")}var s=0;i.is("editor")&&(s=200),r(),angular.element(n).on("resize",r),a.on("$destroy",function(){angular.element(n).off("resize",r)})};return{restrict:"A",priority:50,link:a}}]),angular.module("energy").controller("MainCtrl",["$scope",function(){}]),angular.module("energy").run(["$templateCache",function(e){e.put("app/editor/editor.html",'<div class="container-fluid editor-mode"><div class="row"><div class="col-md-3"><div ng-include="\'components/editor/editor.html\'"></div></div><div class="col-md-9"><energy-map map="map"></energy-map><energy-navigation map="map"></energy-navigation><div class="row"><div class="col-md-6">Last click:<div ng-pluralize="" count="map._selectedZone.length" when="{0: \'southWest\', \'one\': \'northEast\', \'other\':\'\'}"></div><pre ng-if="map._selectedZone.length == 2">            "bounds": {\n                "southWest": {{ map._selectedZone[0] }},\n                "northEast": {{ map._selectedZone[1] }}\n            }</pre></div><div class="col-md-2">Current zoom:<pre>{{ map.center.zoom }}</pre></div></div><div class="row"><div class="col-md-6"><a href="data:application/x-json;base64,{{ getMarker() | json | btoa }}" download="markers.json">markers.json</a></div><div class="col-md-6"><a href="data:application/x-json;base64,{{ steps | json | btoa }}" download="steps.json">steps.json</a></div></div></div></div></div>'),e.put("app/main/main.html",'<div class="Main"><energy-map map="map"></energy-map><energy-navigation map="map"></energy-navigation></div><energy-imprint></energy-imprint><energy-splash></energy-splash>'),e.put("components/editor/editor.html",'<div ng-controller="EditorCtrl as editor" class="Editor" height-like-window=""><a ng-click="editor.selectZone()" class="btn btn-default">Select a zone</a> <a ng-click="editor.addNewLink()" class="btn btn-default">Add a new link</a><div class="Editor__links"><div ng-repeat="marker in editor.markers" class="Editor__link" ng-class="{\'active\': map.markerIndexSelected == $index}"><form class="form"><div><a class="btn btn-danger btn-sm pull-right" ng-click="editor.removeLink(marker)"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a></div><div ng-bind="marker.$$hashKey" ng-click="map.markerIndexSelected=$index"></div><input type="text" ng-model="marker.href" placeholder="text" class="form-control"><div class="row hidden"><div class="col-md-6"><div class="input-group"><span class="input-group-addon" id="basic-addon1">lat</span> <input type="number" ng-model="marker.lat" class="form-control" aria-describedby="basic-addon1" disabled=""></div></div><div class="col-md-6"><div class="input-group"><input type="number" ng-model="marker.lng" class="form-control" aria-describedby="basic-addon2" disabled=""> <span class="input-group-addon" id="basic-addon2">lng</span></div></div></div></form></div></div></div>'),e.put("components/imprint/view.html",'<section id="imprint" class="cd-popup" ng-class="{\'is-visible\': imprint.navInfo.imprint}"><a class="cd-popup-close" ng-click="imprint.closeImprint()">Close</a><div class="inner-content-div"><h2>Energiesystem Stadt</h2><h3>DIE INFORMATIONSARCHITEKTUR DER KOMMUNALEN ENERGIEWENDE</h3><div class="container cd-popup-container"><div class="about"><p>Eine interaktive Infografik für kommunale Entscheidungsträger und Stadtplaner.</p><p>Die Infografik gibt einen Überblick über für die Planung und Umsetzung relevante Themenfelder und stellt die zur Stadtraumtypisierung und energetischen Bilanzierung erforderlichen Daten und Informationen bereit. Die Navigation erfolgt wahlweise über die integrierte Zoomfunktion oder über die Navigationsleiste.</p><p>Entwickelt und umgesetzt im Rahmen des interdisziplinären Forschungsprojektes "Techniken und Strukturen zur Realisation von Energieeffizienz in der Stadt (TestReal)" an der Bauhaus-Universität Weimar.</p></div><div class="impressum"><h4>Impressum</h4><div class="column"><p class="address">Forschergruppe TestReal<br>Bauhaus-Universität Weimar<br>Coudraystaße 7<br>99423 Weimar<br><br><a href="http://www.testreal.org" target="_blank" title="">www.testreal.org</a></p></div><div class="column"><img src="assets/images/test-real.svg" alt="Test Real"> <img src="assets/images/bauhaus-universitat-weimar.svg" alt="Bauhaus Universität Weimar"> <img src="assets/images/esf.svg" alt="ESF"></div><div class="column last"><h5>Projektbearbeitung</h5><ul><li>Dr.-Ing. Dirk Daube, <span class="it">Bauwirtschaftsingenieur</span></li><li>Dipl.-Des. Christopher Doering, <span class="it">Designer</span></li><li>Dr. Manfred Hanfler, <span class="it">Stadtplaner</span></li><li>Dipl.-Ing. Thomas Haupt, <span class="it">Bauingenieur</span></li><li>Dipl.-Ing. Anton Ivanov, <span class="it">Bauingenieur</span></li><li>Dipl.-Ing. Gerd Kiesel, <span class="it">Stadtplaner und Energieberater</span></li><li>Dr. Stefan Knetsch, <span class="it">Geograph</span></li><li>B. Eng. Lisa Köster, <span class="it">Ingenieurin für Geoinformation und Kommunaltechnik</span></li><li>Dipl.-Wirtsch.-Ing. Andrea Lück, <span class="it">Wirtschaftsingenieurin</span></li><li>M.Sc. Tonia Annick Schmitz, <span class="it">Umwelt- und Biomechatronik-Ingenieurin</span></li></ul><h5>Projektbegleitung</h5><ul><li>M.Sc. Daniela Trümer, <span class="it">Umweltingenieurin</span></li><li>Prof. Dr.-Ing. Eckhard Kraft, <span class="it">Professur Biotechnologie in der Ressourcenwirtschaft</span></li><li>Prof. Dr.-Ing. Jörg Londong, <span class="it">Professur Siedlungswasserwirtschaft</span></li><li>Prof. Dr.-Ing. Dipl.-Wirtsch.-Ing. Hans Wilhelm Alfen, <span class="it">Professur Betriebswirtschaftlehre im Bauwesen</span></li><li>Prof. Wolfgang Sattler, <span class="it">Professur Interaction Design</span></li><li>Prof. Dr. Mark Jentsch, <span class="it">Juniorprofessur Urban Energy Systems</span></li></ul><h5>Beirat</h5><ul><li>Jörn Otto (Beiratssprecher), <span class="it">Stadtwerke Weimar Stadtversorgungs-GmbH</span></li><li>Dr. Ulrich Palzer, <span class="it">IAB - Institut für Angewandte Bauforschung Weimar gGmbH</span></li><li>Michael Müller, <span class="it">Energieversorgung Apolda GmbH</span></li><li>Winfried Schöffel, <span class="it">ENVISYS GmbH & Co. KG</span></li><li>Dr. Kersten Roselt, <span class="it">JENA-GEOS Ingenieurbüro GmbH</span></li><li>Carola Westphalen, <span class="it">KNOTEN WEIMAR Internationale Transferstelle Umwelttechnologien GmbH</span></li><li>Dr. Fred Grunert, <span class="it">MAZeT GmbH</span></li><li>Helmut Suske, <span class="it">SWE Energie GmbH</span></li><li>Karsten Kurth, <span class="it">Klimaschutzbeauftragter Stadtverwaltung Weimar</span></li><li>Werner Waschina, <span class="it">Stadtwerke Energie Jena-Pößneck GmbH</span></li></ul><h5>Konzept und Gestaltung</h5><ul><li>Dipl.-Des. Christopher Doering</li></ul><h5>Grafische Bearbeitung</h5><ul><li><a href="http://ti-pi.de">Tine Papendick</a></li></ul></div></div></div></div></section>'),e.put("components/map/map.html",'<div class="Map"><leaflet defaults="map.defaults" center="map.center" maxbounds="map.maxBounds" markers="map.markers" height-like-window=""></leaflet></div>'),e.put("components/navigation/view.html",'<div class="Navigation"><div class="info"><a class="transition cd-popup-trigger" ng-click="nav.openImprint()"><img width="12px" height="27px" src="assets/images/info.svg" alt="Info"></a></div><div class="counter">{{ nav.info.stepIndex + 1 }} / {{ nav.steps.length }}</div><div class="timeline"><div class="timeline-bar"><div class="timeline-marker" ng-repeat="step in nav.steps" ng-click="nav.goTo($index)" ng-style="nav.setMarkerStyle($index)" ng-class="{\'active\': $index === nav.info.stepIndex}"><div class="timeline-point"></div><div class="toolbox"><span>{{ step.shortName }} {{ step.chapter }}<br>{{ step.subChapter }}</span> <img width="130" height="90" ng-src="assets/images/thumbnails/{{ $index + 1 | digit }}.jpg" alt="thumbnail"></div></div></div></div><div class="next-prev"><ul><li class="prev"><a class="transition" ng-click="nav.previous()"><img width="26" height="17" src="assets/images/prev.svg" alt="Prev"></a></li><li class="next"><a class="transition" ng-click="nav.next()"><img width="26" height="17" src="assets/images/next.svg" alt="Next"></a></li></ul></div></div>'),e.put("components/splashscreen/view.html",'<section class="splashscreen" ng-hide="splash.isClose" msd-wheel="splash.close()"><div class="border top"></div><div class="border right"></div><div class="border bottom"></div><div class="border left"></div><div><header><h1>Energiesystem Stadt</h1><h2>DIE INFORMATIONSARCHITEKTUR<br>DER KOMMUNALEN ENERGIEWENDE</h2><h3>Eine interaktive Infografik für kommunale Entscheidungsträger und Stadtplaner</h3></header><div class="animation"><a ng-click="splash.isClose = true"><img src="assets/images/splashscreen.gif" alt="animation"></a></div><footer><div class=""><img src="assets/images/test-real.svg" alt=""></div><div class=""><img src="assets/images/bauhaus-universitat-weimar.svg" alt=""></div><div class=""><img src="assets/images/esf.svg" alt=""></div></footer></div></section>')}]);